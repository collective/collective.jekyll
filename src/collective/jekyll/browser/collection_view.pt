<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="plone">

<metal:main fill-slot="main">

    <h1 class="documentFirstHeading"
        i18n:translate="label_diagnosis">
      Diagnostic
    </h1>
    <tal:issues define="topicContents view/items;
                        batch topicContents;">
                <table class="listing"
                       summary="Content listing"
                       tal:define="use_view_action site_properties/typesUseViewActionInListings|python:();"
                       i18n:attributes="summary summary_content_listing;">
                     <thead>
                       <tr>
                            <th tal:repeat="type view/getSymptomTypes"
                              class="nosort">
                               <a tal:content="type/title"
                                 tal:attributes="title type/help; href type/url" />
                               <span tal:condition="python:view.getSymptomName() == type.name">&#x25bc;</span>
                               </th>
                            <th tal:repeat="field here/selectedViewFields"
                                tal:content="python:field[1]"
                                i18n:translate=""/>
                        </tr>
                     </thead>
                     <tbody>
                       <tal:brain tal:repeat="result topicContents">
                       <tr tal:define="obj python:result[0];
                                       diagnosis python:result[1];
                                       oddrow repeat/result/odd;"
                          tal:attributes="class python:'even' if oddrow else 'odd'">
                            <tal:symptoms repeat="type view/getSymptomTypes">
                            <td tal:define="symptom python:diagnosis.getSymptomByName(type.name)">
                               <span tal:condition="symptom" 
                                     tal:replace="structure symptom/@@status" />
                            </td>
                            </tal:symptoms>
                            <tal:fields repeat="field here/customViewFields"
                                        define="normalizeString nocall:context/@@plone/normalizeString;
                                                toLocalizedTime nocall: context/@@plone/toLocalizedTime;
                                                url obj/getURL;
                                                obj_type obj/portal_type;
                                                obj_type_class     python:'contenttype-' + normalizeString(obj_type);
                                                obj_description obj/Description;
                                                obj_typeinfo python: here.portal_types.getTypeInfo(obj_type);
                                                obj_has_image      python:obj.getIcon;
                                                obj_wf_state obj/review_state|python: wtool.getInfoFor(obj, 'review_state', '');
                                                obj_wf_state_class python:'state-' + normalizeString(obj_wf_state);
                                                obj_url python:url+'/view' if obj_type in use_view_action else url;
                                                title_or_id obj/pretty_title_or_id">
                            <tal:block define="value python: getattr(obj, field, None)">
                                <td tal:condition="python: field != 'Title' and field not in ['ModificationDate',
                                        'CreationDate', 'EffectiveDate',
                                        'ExpirationDate', ]"
                                    tal:content="value"
                                    i18n:translate=""/>
                                <td tal:condition="python:field in ['ModificationDate',
                                        'CreationDate', 'EffectiveDate',
                                        'ExpirationDate', ]">
                                    <span tal:replace="python:toLocalizedTime(value,long_format=1)">
                                      August 16, 2001 at 23:35:59
                                    </span>
                                </td>
                                <td tal:condition="python: field == 'Title'">
                                    <a href="#"
                                        tal:condition="obj_has_image"
                                        tal:attributes="href obj_url;
                                                        title obj_description;">
                                        <img class="thumb-icon"
                                            tal:define="getIcon python:obj.getURL() +'/@@images/image/icon'"
                                            tal:attributes="src  string:$getIcon;alt obj/Description">
                                    </a>
                                    <a href="#"
                                       tal:condition="python: obj.portal_type != 'Link'"
                                       tal:attributes="href obj_url;
                                                       class string:${obj_type_class} ${obj_wf_state_class} url;
                                                       title obj_description;"
                                       tal:content="title_or_id">
                                        Item Title
                                    </a>

                                    <a href="#"
                                       tal:condition="python: obj.portal_type == 'Link'"
                                       tal:attributes="href obj/getRemoteUrl;
                                                       class string:${obj_type_class} ${obj_wf_state_class} link-plain;
                                                       title obj_description;"
                                       class="link-plain"
                                       tal:content="title_or_id" />

                                </td>
                            </tal:block>
                            </tal:fields>
                        </tr>
                        </tal:brain>
                     </tbody>
                </table>
                <div metal:use-macro="context/batch_macros/macros/navigation" />
    </tal:issues>
</metal:main>

</html>
